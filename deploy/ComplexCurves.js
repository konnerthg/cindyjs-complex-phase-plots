/**
 * @license
 *
 * Complex Curves
 *
 * Copyright 2016-2017 Stefan Kranich
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(function(){
'use strict';var k,aa={"Assembly.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nin float index;\nuniform float numIndices;\nuniform sampler2D samplers[1 + N/2];\nuniform float sheet;\nout vec4 posValue;\nvec2 texCoord[3];\n\n#define W 2048.0\n#define H 2048.0\nvec2 uvPosition (in float i) {\nreturn vec2 (mod (i, W) / W + 0.5 / W, floor (i / W) / H + 0.5 / H);\n}\n\nvoid readTex (out vec2 pos[3], out float delta[3], out vec2 values[3*N]) {\nvec4 s;\nfor (int i = 0; i < 3; i++) {\ns = texture (samplers[0], texCoord[i]);\npos[i] = s.xy;\ndelta[i] = s.z;\nfor (int j = 1; j < N/2; j++) {\ns = texture (samplers[j], texCoord[i]);\nvalues[i*N+2*j-2] = s.xy;\nvalues[i*N+2*j-1] = s.zw;\n}\n}\n}\n\nbool valid (in vec2 position[3], in float delta[3]) {\nreturn distance (position[0], position[1]) < min (delta[0], delta[1])\n&& distance (position[1], position[2]) < min (delta[1], delta[2])\n&& distance (position[2], position[0]) < min (delta[2], delta[0]);\n}\n\nvoid main(void) {\nfloat which = mod (index, 3.0);\ntexCoord[0] = uvPosition (index - which);\ntexCoord[1] = uvPosition (index - which + 1.0);\ntexCoord[2] = uvPosition (index - which + 2.0);\n\nint isheet = int(sheet);\nif (isheet < sheets) {\nvec2 pos[3];\nfloat delta[3];\nvec2 values[3*N];\nreadTex (pos, delta, values);\nif (valid (pos, delta)) {\nfor (int s = 0; s < sheets; s++) {\nif (s == isheet) {\nvec2 valueA = values[s];\nint iwhich = int(which);\nfor (int w = 0; w < 3; w++) {\nif (w == iwhich) {\nvec2 valueWhich = values[w*N];\nfloat dist, minDist = distance (valueA, valueWhich);\nfor (int i = 1; i < sheets; i++) {\ndist = distance (valueA, values[w*N+i]);\nif (dist < minDist)\n{\nvalueWhich = values[w*N+i];\nminDist = dist;\n}\n}\nposValue = vec4(pos[w], valueWhich);\n}\n}\n}\n}\nreturn;\n}\n}\nposValue = vec4(-10.0, -10.0, -10.0, 1.0);\n}\n",
"CachedSurface.frag":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform bool clipping;\nvarying vec4 vPos;\nvarying vec2 vValue;\nvec3 hue_to_rgb (in float hue)\n{\nhue = mod (degrees (hue), 360.0) / 60.0;\nint h = int (floor (hue));\nfloat f = fract (hue);\nif (h == 0)\nreturn vec3 (1.0, f, 0.0);\nelse if (h == 1)\nreturn vec3 (1.0 - f, 1.0, 0.0);\nelse if (h == 2)\nreturn vec3 (0.0, 1.0, f);\nelse if (h == 3)\nreturn vec3 (0.0, 1.0 - f, 1.0);\nelse if (h == 4)\nreturn vec3 (f, 0.0, 1.0);\nelse if (h == 5)\nreturn vec3 (1.0, 0.0, 1.0 - f);\n}\nfloat sawfct (float x, float dx, float a, float b)\n{\nreturn a + (b - a) * fract (x / dx);\n}\nvoid main (void)\n{\nif (clipping && vPos.y < 0.0)\ndiscard;\nfloat PI = acos (-1.0);\nfloat angle = atan (vValue.y, vValue.x);\nfloat blackp = sawfct (angle, PI / 12.0, 0.7, 1.0);\nfloat blackm = sawfct (log (length (vValue)), PI / 12.0, 0.7, 1.0);\nfloat black = blackp * blackm;\ngl_FragColor = vec4 (black * hue_to_rgb (angle), gl_FragCoord.z);\n}\n",
"CachedSurface.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nattribute vec4 position;\nuniform mat4 m, v, p;\nvarying vec4 vPos;\nvarying vec2 vValue;\nvoid main (void)\n{\nvPos = vec4 (position.xyz, 1.0);\nvValue = position.zw;\ngl_Position = p * v * m * vPos;\n}\n","Common.glsl":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#define EPS 5e-3\n\n/* complex division */\nvec2 cd (in vec2 a, in vec2 b) {\n\treturn vec2 (a.x * b.x + a.y * b.y, a.y * b.x - a.x * b.y) / dot (b, b);\n}\n\nvec2 cinv (in vec2 z) {\nreturn vec2(z.x, -z.y) / dot(z, z);\n}\n\n/* complex square root */\nvec2 csqrt (in vec2 z)\n{\nfloat r = sqrt (length (z));\nfloat phi = 0.5 * atan (z.y, z.x);\nreturn r * vec2 (cos (phi), sin (phi));\n}\n\nvec2 horner (in int n, in vec2 cs[N+1], in vec2 x) {\nvec2 p;\nfor (int i = N - 1; i >= 0; i--)\nif (i >= n)\np = cs[i];\nelse if (i < n)\np = cs[i] + cm(p, x);\nreturn p;\n}\n\nvoid weierstrass (in vec2 cs[N+1], out vec2 roots2[N]) {\n\t/* polynomial must be monic! */\nvec2 csn = cs[sheets];\nif (csn != vec2 (1.0, 0.0))\nfor (int i = 0; i <= sheets; i++)\ncs[i] = cd (cs[i], csn);\n\nfloat maxabs = length (cs[0]);\nfor (int i = 1; i < N; i++)\nif (i < sheets)\nmaxabs = max (maxabs, length (cs[i]));\nfloat upperBound = 1.0 + maxabs; /// length (cs[n]);\nfloat phi = 2.0 * acos (-1.0) / float (sheets + 1);\nfloat d = upperBound / float (sheets);\nd = clamp (d, 1.0, 10.0);\n\tfor (int i = 0; i < sheets; i++)\nroots2[i] = float (i) * d * vec2 (cos (float (i) * phi), sin (float (i) * phi));\n\n\tconst int maxiter = 50;\n\tbool changing;\n\tfor (int iter = 0; iter < maxiter; iter++)\n\t{\n\t\tchanging = false;\n\t\tfor (int i = 0; i < sheets; i++)\n{\nvec2 result = vec2 (1.0, 0.0);\nfor (int j = 0; j < sheets; j++)\nif (j != i)\nresult = cm (result, roots2[i] - roots2[j]);\nvec2 update = cd (horner (sheets, cs, roots2[i]), result);\n///* safe-guard against large update */\n//if (sheets > 1 && length (update) > 10)\n//\tupdate /= length (update);\nif (length (update) > 1e-2)\nchanging = true;\nroots2[i] -= update;\n}\nif (!changing)\nbreak;\n\t}\n}\n\nvoid quadratic_roots (in vec2 cs[N+1], out vec2 qroots[2]) {\nif (cs[0] == vec2 (0.0, 0.0)) {\nqroots[0] = vec2 (0.0, 0.0);\nqroots[1] = -cd (cs[1], cs[2]);\n}\nelse\n{\nvec2 r = csqrt (cm (cs[1], cs[1]) - 4.0 * cm (cs[2], cs[0]));\nif (cs[1].x >= 0.0)\nr = -r;\nqroots[0] = cd (r - cs[1], 2.0 * cs[2]);\nqroots[1] = cd (2.0 * cs[0], r - cs[1]);\n}\n}\n\nvoid roots (in int n, in vec2 cs[N+1], out vec2 roots[N])\n{\nif (n == 1) {\nroots[0] = -cd (cs[0], cs[1]);\nreturn;\n}\nif (n == 2) {\nvec2 qroots[2];\nquadratic_roots (cs, qroots);\nroots[0] = qroots[0];\nroots[1] = qroots[1];\nreturn;\n}\nweierstrass (cs, roots);\n/* selection sort by real part */\n/*\nfor(int i = 0; i < n - 1; i++)\n{\nint jmin = i;\nfor (int j = i + 1; j < n; j++)\nif (roots[j].x < roots[jmin].x)\njmin = j;\nvec2 z = roots[i];\nroots[i] = roots[jmin];\nroots[jmin] = z;\n}\n*/\n}\n\nvoid f (in vec2 x, out vec2 cs[N+1]);\nvec2 fx (in vec2 x, in vec2 y);\nvec2 fy (in vec2 x, in vec2 y);\nfloat rho (in vec2 x);\nfloat M (in vec2 x, in float rho);\n\nfloat epsilon (in vec2 ys[N]) {\nfloat d = distance (ys[0], ys[1]);\nif (sheets < 2)\nreturn 1.0 / 0.0;\nfor (int j = 0; j < sheets; j++) {\nfor (int k = 0; k < sheets; k++) {\nif (k > j)\nd = min (d, distance (ys[j], ys[k]));\n}\n}\nreturn d / 2.0;\n}\n\nfloat Y (in vec2 x, in vec2 ys[N]) {\nfloat y = length (cd (fx (x, ys[0]), fy (x, ys[0])));\nfor (int j = 0; j < sheets; j++)\ny = max (y, length (cd (fx (x, ys[j]), fy (x, ys[j]))));\nreturn y;\n}\n\nfloat Delta (in vec2 x, in vec2 ys[N]) {\nfloat eps = epsilon (ys);\nfloat r = rho (x);\nfloat m = M (x, r);\nfloat y = Y (x, ys);\nreturn r * (sqrt (pow (r * y - eps, 2.0) + 4.0 * eps * m) -\n(r * y + eps)) / (2.0 * (m - r * y));\n}\n",
"DomainColouring.frag":"\nuniform int sheet;\nvarying vec2 vPosition;\nvec3 hue_to_rgb (in float hue)\n{\nhue = mod (degrees (hue), 360.0) / 60.0;\nint h = int (floor (hue));\nfloat f = fract (hue);\nif (h == 0)\nreturn vec3 (1.0, f, 0.0);\nelse if (h == 1)\nreturn vec3 (1.0 - f, 1.0, 0.0);\nelse if (h == 2)\nreturn vec3 (0.0, 1.0, f);\nelse if (h == 3)\nreturn vec3 (0.0, 1.0 - f, 1.0);\nelse if (h == 4)\nreturn vec3 (f, 0.0, 1.0);\nelse if (h == 5)\nreturn vec3 (1.0, 0.0, 1.0 - f);\n}\nfloat sawfct (float x, float dx, float a, float b)\n{\nreturn a + (b - a) * fract (x / dx);\n}\nvoid main (void)\n{\nvec2 cs[N+1];\nvec2 ys[N];\nvec2 value;\nf (vPosition, cs);\nroots (sheets, cs, ys);\nint smaller;\nfor (int i = 0; i < sheets; i++)\n{\nsmaller = 0;\nfor (int j = 0; j < sheets; j++)\nif (ys[j].x < ys[i].x)\nsmaller++;\nif (smaller == sheet - 1)\nvalue = ys[i];\n}\n\nfloat PI = acos (-1.0);\nfloat angle = atan (value.y, value.x);\nfloat blackp = sawfct (angle, PI / 12.0, 0.7, 1.0);\nfloat blackm = sawfct (log (length (value)), PI / 12.0, 0.7, 1.0);\nfloat black = blackp * blackm;\ngl_FragColor = vec4 (black * hue_to_rgb(angle), 1.0);\n}\n",
"DomainColouring.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nattribute vec2 position;\nvarying vec2 vPosition;\nvoid main () {\ngl_Position = vec4 (position, 0.0, 1.0);\nvPosition = 5.0 * position;\n}\n","Dummy.frag":"\n#version 300 es\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nout vec4 fColor;\nvoid main(void) {\nfColor = vec4(1.0);\n}\n","Export.frag":"\n#version 300 es\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nin vec2 vValue;\nout vec4 fColor;\nvec3 hue_to_rgb (in float hue)\n{\nhue = mod (degrees (hue), 360.0) / 60.0;\nint h = int (floor (hue));\nfloat f = fract (hue);\nif (h == 0)\nreturn vec3 (1.0, f, 0.0);\nelse if (h == 1)\nreturn vec3 (1.0 - f, 1.0, 0.0);\nelse if (h == 2)\nreturn vec3 (0.0, 1.0, f);\nelse if (h == 3)\nreturn vec3 (0.0, 1.0 - f, 1.0);\nelse if (h == 4)\nreturn vec3 (f, 0.0, 1.0);\nelse if (h == 5)\nreturn vec3 (1.0, 0.0, 1.0 - f);\n}\nfloat sawfct (float x, float dx, float a, float b)\n{\nreturn a + (b - a) * fract (x / dx);\n}\nvoid main (void)\n{\nfloat PI = acos (-1.0);\nfloat angle = atan (vValue.y, vValue.x);\nfloat blackp = sawfct (angle / (2.0 * PI), 0.05, 0.7, 1.0);\nfloat blackm = sawfct (log (length (vValue)), 0.1 * PI, 0.7, 1.0);\nfloat black = blackp * blackm;\nfColor = vec4 (black * hue_to_rgb(angle), 1.0);\n}\n",
"Export.vert":"\n#version 300 es\nuniform float maxValue;\nuniform float minValue;\nin vec2 vPosition;\nout vec2 vValue;\n\nvoid main()\n{\ngl_Position = vec4(vPosition, 0.0, 1.0);\nvValue = 0.5 * (maxValue - minValue) * (vPosition + vec2 (1.0, 1.0))\n+ vec2 (minValue, minValue);\n}\n","FXAA.frag":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform sampler2D u_tex;\nuniform float width;\nuniform float height;\n\n#define FXAA_REDUCE_MIN (1.0/ 128.0)\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#define FXAA_SPAN_MAX 8.0\n// from https://github.com/mitsuhiko/webgl-meincraft/blob/master/assets/shaders/fxaa.glsl\nvec4 applyFXAA(in vec2 fragCoord, in sampler2D tex)\n{\nvec4 color;\nvec2 inverseVP = vec2(1.0 / width, 1.0 / height);\nvec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;\nvec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;\nvec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;\nvec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;\nvec3 rgbM = texture2D(tex, fragCoord * inverseVP).xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM = dot(rgbM, luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y = ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\nmax(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, 1.0);\nelse\ncolor = vec4(rgbB, 1.0);\nreturn color;\n}\n\nvoid main (void)\n{\ngl_FragColor = applyFXAA(gl_FragCoord.xy, u_tex);\n}\n",
"FXAA.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nattribute vec2 vPosition;\nvoid main()\n{\ngl_Position = vec4(vPosition, 0.0, 1.0);\n}\n","Initial.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nin vec2 pos;\nout vec2 position;\nout float delta;\nout float subdivisionFlag;\nout vec2 values[N];\nvoid main (void) {\nposition = clamp (pos, -5.0, 5.0);\nvec2 cs[N+1];\nf (position, cs);\nroots (sheets, cs, values);\ndelta = Delta (position, values);\nsubdivisionFlag = 1.0;\n}\n",
"Subdivision.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nin vec3 barycentric;\nin float indexOffsetIn;\nuniform sampler2D samplers[1 + N/2];\nout vec2 position;\nout float delta;\nout float subdivisionFlag;\nout vec2 values[N];\n\n#define W 2048.0\n#define H 2048.0\nvec2 uvPosition (in float i) {\nreturn vec2 (mod (i, W) / W + 0.5 / W, floor (i / W) / H + 0.5 / H);\n}\n\nvoid main (void) {\nvec2 texCoord[3];\ntexCoord[0] = uvPosition (indexOffsetIn);\ntexCoord[1] = uvPosition (indexOffsetIn + 1.0);\ntexCoord[2] = uvPosition (indexOffsetIn + 2.0);\nvec4 tmp;\n\nif (barycentric == vec3 (1.0, 0.0, 0.0)) {\ntmp = texture (samplers[0], texCoord[0]);\nposition = tmp.xy;\ndelta = tmp.z;\nsubdivisionFlag = tmp.w;\nfor (int j = 1; j < 1 + N/2; j++) {\ntmp = texture (samplers[j], texCoord[0]);\nvalues[2 * j - 2] = tmp.xy;\nvalues[2 * j - 1] = tmp.zw;\n}\n} else if (barycentric == vec3 (0.0, 1.0, 0.0)) {\ntmp = texture (samplers[0], texCoord[1]);\nposition = tmp.xy;\ndelta = tmp.z;\nsubdivisionFlag = tmp.w;\nfor (int j = 1; j < 1 + N/2; j++) {\ntmp = texture (samplers[j], texCoord[1]);\nvalues[2 * j - 2] = tmp.xy;\nvalues[2 * j - 1] = tmp.zw;\n}\n} else if (barycentric == vec3 (0.0, 0.0, 1.0)) {\ntmp = texture (samplers[0], texCoord[2]);\nposition = tmp.xy;\ndelta = tmp.z;\nsubdivisionFlag = tmp.w;\nfor (int j = 1; j < 1 + N/2; j++) {\ntmp = texture (samplers[j], texCoord[2]);\nvalues[2 * j - 2] = tmp.xy;\nvalues[2 * j - 1] = tmp.zw;\n}\n} else {\nposition = barycentric.x * texture (samplers[0], texCoord[0]).xy\n+ barycentric.y * texture (samplers[0], texCoord[1]).xy\n+ barycentric.z * texture (samplers[0], texCoord[2]).xy;\nvec2 cs[N+1];\nf (position, cs);\nroots (sheets, cs, values);\ndelta = Delta (position, values);\nsubdivisionFlag = 1.0;\n}\n}\n",
"SubdivisionPre.vert":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nin float index;\nuniform sampler2D samplers[1 + N/2];\nout vec2 position;\nout float delta;\nout float subdivisionFlag;\nout vec2 values[N];\n\n#define W 2048.0\n#define H 2048.0\nvec2 uvPosition (in float i) {\nreturn vec2 (mod (i, W) / W + 0.5 / W, floor (i / W) / H + 0.5 / H);\n}\n\nvoid main (void) {\nfloat which = mod (index, 3.0);\nvec2 texCoordWhich = uvPosition (index);\nvec2 texCoord[3];\ntexCoord[0] = uvPosition (index - which);\ntexCoord[1] = uvPosition (index - which + 1.0);\ntexCoord[2] = uvPosition (index - which + 2.0);\nvec4 s = texture (samplers[0], texCoordWhich);\nposition = s.xy;\ndelta = s.z;\nsubdivisionFlag = 0.0;\nvec3 positionDelta[3];\npositionDelta[0] = texture (samplers[0], texCoord[0]).xyz;\npositionDelta[1] = texture (samplers[0], texCoord[1]).xyz;\npositionDelta[2] = texture (samplers[0], texCoord[2]).xyz;\nif (distance (positionDelta[0].xy, positionDelta[1].xy) >= min (positionDelta[0].z, positionDelta[1].z))\nsubdivisionFlag += 4.0;\nif (distance (positionDelta[1].xy, positionDelta[2].xy) >= min (positionDelta[1].z, positionDelta[2].z))\nsubdivisionFlag += 2.0;\nif (distance (positionDelta[2].xy, positionDelta[0].xy) >= min (positionDelta[2].z, positionDelta[0].z))\nsubdivisionFlag += 1.0;\nif (subdivisionFlag == 3.0 && distance (positionDelta[0].xy, 0.5 * (positionDelta[1].xy + positionDelta[2].xy)) < distance (positionDelta[1].xy, 0.5 * (positionDelta[0].xy + positionDelta[2].xy)))\nsubdivisionFlag = 8.0;\nif (subdivisionFlag == 5.0 && distance (positionDelta[1].xy, 0.5 * (positionDelta[0].xy + positionDelta[2].xy)) < distance (positionDelta[2].xy, 0.5 * (positionDelta[0].xy + positionDelta[1].xy)))\nsubdivisionFlag = 9.0;\nif (subdivisionFlag == 6.0 && distance (positionDelta[2].xy, 0.5 * (positionDelta[0].xy + positionDelta[1].xy)) < distance (positionDelta[0].xy, 0.5 * (positionDelta[1].xy + positionDelta[2].xy)))\nsubdivisionFlag = 10.0;\nfor (int i = 1; i < N/2; i++) {\ns = texture (samplers[i], texCoordWhich);\nvalues[2*i-2] = s.xy;\nvalues[2*i-1] = s.zw;\n}\n}\n",
"Surface.frag":"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform bool clipping;\nin vec4 vPos;\nin vec2 v_value;\nout vec4 fColor;\nvec3 hue_to_rgb (in float hue)\n{\nhue = mod (degrees (hue), 360.0) / 60.0;\nint h = int (floor (hue));\nfloat f = fract (hue);\nif (h == 0)\nreturn vec3 (1.0, f, 0.0);\nelse if (h == 1)\nreturn vec3 (1.0 - f, 1.0, 0.0);\nelse if (h == 2)\nreturn vec3 (0.0, 1.0, f);\nelse if (h == 3)\nreturn vec3 (0.0, 1.0 - f, 1.0);\nelse if (h == 4)\nreturn vec3 (f, 0.0, 1.0);\nelse if (h == 5)\nreturn vec3 (1.0, 0.0, 1.0 - f);\n}\nfloat sawfct (float x, float dx, float a, float b)\n{\nreturn a + (b - a) * fract (x / dx);\n}\nvoid main (void)\n{\nif (clipping && vPos.y < 0.0)\ndiscard;\nfloat PI = acos (-1.0);\nfloat angle = atan (v_value.y, v_value.x);\nfloat blackp = sawfct (angle, PI / 12.0, 0.7, 1.0);\nfloat blackm = sawfct (log (length (v_value)), PI / 12.0, 0.7, 1.0);\nfloat black = blackp * blackm;\nfColor = vec4 (black * hue_to_rgb (angle), gl_FragCoord.z);\n}\n",
"Surface.vert":"\n#version 300 es\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform mat4 m;\nuniform mat4 v;\nuniform mat4 p;\nin vec4 posValue;\nout vec4 vPos;\nout vec2 v_value;\nvoid main (void)\n{\nvPos = vec4 (posValue.xyz, 1.0);\nv_value = posValue.zw;\ngl_Position = p * v * m * vPos;\n}\n"};function m(){}
m.a=function(a){if(null===a)return null;var c=a.type,b=a.value;if("infix"===c){c=m.a(a.first);a=m.a(a.second);if("+"===b)return ba(c,a);if("-"===b)return ba(c,ca(a));if("*"===b)return da(c,a);if("^"===b){if(ea(a)&&(b=fa(a),0<=b.a&&!b.b))return ha(c,b.a);console.error("Illegal exponent")}else console.error("Infix operator '"+b+"' not implemented")}else if("prefix"===c){c=m.a(a.first);if("+"===b)return c;if("-"===b)return ca(c);console.error("Prefix operator '"+b+"' not implemented")}else{if("number"===c)return new t([new u(w(parseFloat(b)),
new y({}))]);if("variable"===c)return c={},c[b]=1,new t([new u(ia,new y(c))]);if("imaginary"===c)return new t([new u(new z(0,1),new y({}))])}return null};m.f=function(a){return 2===A(a).length};
m.b=function(a){function c(a,b){function c(a,b){return{type:"infix",value:b[0].value,first:a,second:b[1]}}return b===[]?a:b.reduce(c,a)}function b(a){a=B(ja(la(l,d),d),ma(B(l,d)))(a);return null===a?null:c(a[0],a[1])}function d(a){a=B(e,ma(B(q,e)))(a);return null===a?null:c(a[0],a[1])}function e(a){var c=ja(na(b),g,h,n)(a);if(null===c)return null;a=f(a);return null===a?c:{type:"infix",value:"^",first:c,second:a}}function f(a){var b=B(p,g)(a);if(null===b)return null;a=f(a);return null===a?b[1]:{type:"infix",
value:"^",first:b[1],second:a}}a=oa(a);var g=pa("number"),h=pa("imaginary"),n=pa("variable"),l=ja(D("+"),D("-")),q=D("*"),p=D("^");return function(a){a=B(b,qa)(a);return null===a?null:a[0]}(a)};m.g=function(a){return ra(a)};var E=5/12*Math.PI,F=Math.PI/6;function G(a,c,b,d,e){c=void 0===c?E:c;b=void 0===b?F:b;this.f=a;c=H(c,b);b=new sa;b.w=void 0===d?!1:d;b.i=b.O=b.m=c;this.a=b;this.b=new ta(a,void 0===e?"webgl2":e);ua(this)}function va(a,c,b,d,e,f){d=void 0===d?E:d;e=void 0===e?F:e;a=new G(a,d,e,void 0===f?!1:f);d=a.b;d.o=new wa(d,c,b);if(2!==A(c).length||2>d.o.G)return null;I(a);return a}k=G.prototype;k.na=function(a){var c=this.b;return c.o.aa(c,void 0===a?!1:a)};
k.oa=function(a){var c=this.b;c.o.ba(c,void 0===a?"surface.bin":a)};k.pa=function(a,c){var b=this.b;b.o.ca(b,void 0===a?"sheet":a,void 0===c?!0:c)};k.Ba=function(a,c){a=void 0===a?"surface.png":a;c=void 0===c?!1:c;var b=this,d=this.b;xa(d,function(){I(b)},c);c=ya(d,c?d.v:d.u);J(a,za(c))};k.qa=function(a,c){var b=this.b;b.o.da(b,void 0===a?"surface":a,void 0===c?!0:c)};
function ua(a){var c=a.f,b=a.a;a.g=function(c){c.preventDefault();b.l||(Aa(b,[c.clientX,c.clientY]),I(a))};a.K=function(a){a.preventDefault();Ca(b,a.clientX,a.clientY)};a.L=function(a){a.preventDefault();b.N=[0,0];b.A=!1};a.la=function(c){c.preventDefault();c=c.touches[0];Aa(b,[c.clientX,c.clientY]);I(a)};a.ka=function(a){a.preventDefault();a=a.touches[0];Ca(b,a.clientX,a.clientY)};a.M=function(a){a.preventDefault();b.N=[0,0];b.A=!1};a.ma=function(c){c.preventDefault();b.B=0<c.deltaY?Math.min(4,b.B+
.1):Math.max(.5,b.B-.1);I(a)};c.addEventListener("mousedown",a.g);c.addEventListener("mousemove",a.K);c.addEventListener("mouseup",a.L);c.addEventListener("touchstart",a.la);c.addEventListener("touchmove",a.ka);c.addEventListener("touchend",a.M);c.addEventListener("wheel",a.ma)}function I(a){var c=a.a;Da(a.b,c);if(c.l||c.A||1E-6<Ea(c.i,c.m).abs())Fa(c),requestAnimationFrame(function(){I(a)})}k.Ca=function(){this.s(Math.PI/2,Math.PI)};k.Da=function(){this.s(Math.PI,0)};k.Ea=function(){this.s(E,F)};
k.Fa=function(){this.s(Math.PI/2,0)};k.s=function(a,c){this.a.l=!1;this.a.m=this.a.O=this.a.i;this.a.m=H(a,c);I(this)};k.Ga=function(){this.s(Math.PI/2,-Math.PI/2)};k.Ha=function(){this.s(Math.PI/2,Math.PI/2)};k.Ia=function(){this.s(0,0)};k.ra=function(a){this.b.I=a;I(this)};k.sa=function(a){this.a.l=a;I(this)};k.Ja=function(a,c,b,d){this.b.c.clearColor(a,c,b,d);I(this)};k.ta=function(a){this.b.H=a;I(this)};k.Ka=function(a,c){a=H(a,c);this.a.l=!1;this.a.A=!1;this.a.i=this.a.m=a;I(this)};
k.ua=function(a){this.a.w=a;I(this)};k.va=function(a){this.b.R=a;I(this)};k.La=function(a){this.a.B=a||1;I(this)};k.wa=function(){var a=this.b;a.I=!a.I;I(this)};k.xa=function(){var a=this.a;a.l=!a.l;I(this)};k.ya=function(){var a=this.b;a.H=!a.H;I(this)};k.za=function(){var a=this.a;a.w=!a.w;I(this)};k.Aa=function(){var a=this.b;a.R=!a.R;I(this)};
k.Ma=function(){var a=this.f;a.removeEventListener("mousedown",this.g);a.removeEventListener("mousemove",this.K);a.removeEventListener("mouseup",this.L);a.removeEventListener("touchstart",this.la);a.removeEventListener("touchmove",this.ka);a.removeEventListener("touchend",this.M);a.removeEventListener("wheel",this.ma)};window.ComplexCurves=G;G.fromEquation=function(a,c,b,d,e,f){d=void 0===d?E:d;e=void 0===e?F:e;f=void 0===f?!1:f;c=m.a(m.b(c));return va(a,c,b,d,e,f)};G.fromFile=function(a,c,b,d,e,f,g){d=void 0===d?E:d;e=void 0===e?F:e;f=void 0===f?!1:f;g=g?g:function(){};b=m.a(m.b(void 0===b?"":b));var h=new G(a,d,e,f,"webgl");a=h.b;a.o=new Ga(a,c,b,function(){I(h);g()});return h};G.fromPolynomial=va;G.prototype.domainColouring=G.prototype.na;G.prototype.exportBinary=G.prototype.oa;
G.prototype.exportDomainColouring=G.prototype.pa;G.prototype.exportScreenshot=G.prototype.Ba;G.prototype.exportSurface=G.prototype.qa;G.prototype.rotateBack=G.prototype.Ca;G.prototype.rotateBottom=G.prototype.Da;G.prototype.rotateDefault=G.prototype.Ea;G.prototype.rotateFront=G.prototype.Fa;G.prototype.rotateLatLong=G.prototype.s;G.prototype.rotateLeft=G.prototype.Ga;G.prototype.rotateRight=G.prototype.Ha;G.prototype.rotateTop=G.prototype.Ia;G.prototype.setAntialiasing=G.prototype.ra;
G.prototype.setAutorotate=G.prototype.sa;G.prototype.setBackground=G.prototype.Ja;G.prototype.setClipping=G.prototype.ta;G.prototype.setLatLong=G.prototype.Ka;G.prototype.setOrtho=G.prototype.ua;G.prototype.setTransparency=G.prototype.va;G.prototype.setZoom=G.prototype.La;G.prototype.toggleAntialiasing=G.prototype.wa;G.prototype.toggleAutorotate=G.prototype.xa;G.prototype.toggleClipping=G.prototype.ya;G.prototype.toggleOrtho=G.prototype.za;G.prototype.toggleTransparency=G.prototype.Aa;
G.prototype.unregisterEventHandlers=G.prototype.Ma;window.PolynomialParser=m;m.eval=m.a;m.isBivariate=m.f;m.parse=m.b;m.sheets=m.g;function Ha(a,c){var b=[K("Assembly.vert"),K("Dummy.frag")];b[0]=L(c,b[0]);this.a=M(a,b,["posValue"])}Ha.prototype.a=null;
Ha.prototype.j=function(a,c,b){var d=c.F;b.useProgram(this.a);var e=c.h;b.uniform1f(b.getUniformLocation(this.a,"numIndices"),e);Ia(c,a);b.vertexAttribPointer(0,1,b.FLOAT,!1,0,0);var f=c.G;a=4*e*f;for(var g=[],h=0,n=d.length;h<n;h++)b.activeTexture(b.TEXTURE0+h),b.bindTexture(b.TEXTURE_2D,d[h]),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),g[h]=h;b.uniform1iv(b.getUniformLocation(this.a,"samplers"),g);b.disable(b.DEPTH_TEST);var l=b.getUniformLocation(this.a,"sheet");Ja(b,c,a,function(){for(var a=0;a<f;a++)b.uniform1f(l,a),b.drawArrays(b.TRIANGLES,0,e)});c.h*=f;b.enable(b.DEPTH_TEST)};function Ga(a,c,b,d){d=d?d:function(){};var e=this;e.C=void 0===b?null:b;Ka(e,c,function(){var b=e.V,c=a.c;e.fa=b.byteLength/16;c.enableVertexAttribArray(0);e.W=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,e.W);c.bufferData(c.ARRAY_BUFFER,new Float32Array(b),c.STATIC_DRAW);e.S=M(a,N("CachedSurface"));d()})}k=Ga.prototype;k.aa=function(a,c){return this.C?La(this.C,a,void 0===c?!1:c):[]};k.ba=function(a,c){J(void 0===c?"surface.bin":c,this.ea)};
k.ca=function(a,c,b){this.C&&Ma(this.C,a,void 0===c?"sheet":c,void 0===b?!0:b)};k.da=function(a,c,b){c=void 0===c?"surface":c;b=void 0===b?!0:b;Na(a,new Float32Array(this.V),c,b)};k.ea="";function Ka(a,c,b){a.ea=c;var d=new XMLHttpRequest;d.open("GET",c,!0);d.responseType="arraybuffer";d.onload=function(){a.V=d.response;b()};d.send()}k.C=null;k.V=null;k.W=null;k.S=null;
k.j=function(a,c,b){this.S&&(c.useProgram(this.S),Oa(a),Pa(a,"m",Qa(b.i)),Ra(a,b),Sa(a,b),Ta(a),c.bindBuffer(c.ARRAY_BUFFER,this.W),c.vertexAttribPointer(0,4,c.FLOAT,!1,0,0),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),c.drawArrays(c.TRIANGLES,0,this.fa),Ta(a,!1))};k.fa=0;function z(a,c){this.a=a;this.b=c}z.prototype.abs=function(){return Math.sqrt(this.a*this.a+this.b*this.b)};function O(a,c){return new z(a.a+c.a,a.b+c.b)}function P(a,c){var b=c.a*c.a+c.b*c.b;return new z((a.a*c.a+a.b*c.b)/b,(a.b*c.a-a.a*c.b)/b)}z.prototype.b=0;var Ua=new z(Infinity,Infinity);function Q(a,c){return new z(a.a*c.a-a.b*c.b,a.a*c.b+a.b*c.a)}function Va(a){return new z(-a.a,-a.b)}var ia=new z(1,0);z.prototype.a=0;function w(a){return new z(a,0)}
function Wa(a){if(!a.a&&!a.b)return R();var c=a.abs();return new z(Math.sqrt(.5*(c+a.a)),(Math.sign(a.b)||1)*Math.sqrt(.5*(c-a.a)))}function S(a,c){return new z(a.a-c.a,a.b-c.b)}function R(){return new z(0,0)};function La(a,c,b){function d(a){e.useProgram(h);e.bindBuffer(e.ARRAY_BUFFER,c.D);e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0);n=e.getUniformLocation(h,"sheet");e.uniform1i(n,a);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.drawArrays(e.TRIANGLES,0,3)}b=void 0===b?!1:b;var e=c.c,f=N("DomainColouring"),g=Xa(a);f[1]=[g,aa["Common.glsl"],f[1]].join("\n");var h=M(c,f),n;f=A(a);a=T(a,f.length?f[f.length-1]:"y");f=[];for(var l=1;l<=a;l++)xa(c,d.bind(null,l),b),g=ya(c,b?c.v:c.u),f[l-1]=za(g);return f}
function J(a,c){var b=document.createElement("a");b.href=c;b.download=a;b.style.display="none";document.body.appendChild(b);b.click();document.body.removeChild(b)}function Ma(a,c,b,d){b=void 0===b?"sheet":b;a=La(a,c,void 0===d?!0:d);c=0;for(d=a.length;c<d;c++)J(b+(c+1)+".png",a[c])}
function Na(a,c,b,d){b=void 0===b?"surface":b;d=void 0===d?!0:d;var e,f=-Infinity,g=Infinity;var h=c.byteLength/c.BYTES_PER_ELEMENT/4;var n=[];for(e=0;e<4*h;e+=4){var l=c[e];var q=c[e+1];var p=c[e+2];var r=c[e+3];n.push([l,q,p]);g=Math.min(g,Math.min(p,r));f=Math.max(f,Math.max(p,r))}l=f-g;var v=[];for(e=2;e<4*h;e+=4)q=(c[e]-g)/l,p=(c[e+1]-g)/l,v.push([q,p]);c=[];for(e=1;e<=h;e+=3)l=e+1,q=e+2,c.push([e,l,q]);var C=n.map(function(a,b){var c=v[b];return n.findIndex(function(b,d){d=v[d];return a[0]===
b[0]&&a[1]===b[1]&&a[2]===b[2]&&c[0]===d[0]&&c[1]===d[1]})});var V=Array.from(new Set(C));n=V.map(function(a){return n[a]});v=V.map(function(a){return v[a]});c=c.map(function(a){return a.map(function(a){return V.findIndex(function(b){return b===C[a-1]})+1})});e=n.map(function(a){return"v "+a[0]+" "+a[1]+" "+a[2]});h=v.map(function(a){return"vt "+a[0]+" "+a[1]});c=c.map(function(a){var b=a[0],c=a[1];a=a[2];return"f "+b+"/"+b+" "+c+"/"+c+" "+a+"/"+a});l=["mtllib "+b+".mtl","usemtl surface","s 1"];l=
l.concat(e,h,c);l="data:text/plain,"+encodeURIComponent(l.join("\n"));J(b+".obj",l);var x=a.c,Ba=M(a,N("Export")),ka;xa(a,function(){x.useProgram(Ba);x.bindBuffer(x.ARRAY_BUFFER,a.D);x.vertexAttribPointer(0,2,x.FLOAT,!1,0,0);ka=x.getUniformLocation(Ba,"minValue");x.uniform1f(ka,g);ka=x.getUniformLocation(Ba,"maxValue");x.uniform1f(ka,f);x.clear(x.COLOR_BUFFER_BIT|x.DEPTH_BUFFER_BIT);x.drawArrays(x.TRIANGLES,0,3)},d);d=ya(a,d?a.v:a.u);J(b+".png",za(d));d=["newmtl surface","map_Kd "+b+".png","illum 0"];
d="data:text/plain,"+encodeURIComponent(d.join("\n"));J(b+".mtl",d)}function za(a){var c=Math.sqrt(a.length/4),b=document.createElement("canvas");b.width=c;b.height=c;var d=b.getContext("2d"),e=d.createImageData(b.width,b.height);e.data.set(a);d.putImageData(e,0,0);a=document.createElement("canvas");a.width=c;a.height=c;c=a.getContext("2d");c.translate(0,a.height-1);c.scale(1,-1);c.drawImage(b,0,0);return a.toDataURL()};function Ya(a){var c=[],b;if(ea(a))return[U(fa(a))];if(1===A(a).length){a=Za(a);var d=0;for(b=a.length;d<b;d++)c[d]=U(a[d])}else if(2===A(a).length){d=A(a);var e=d[0];a=W(a,d[1]);d=0;for(b=a.length;d<b;d++)c[d]=X(e,Ya(a[d]))}return c}function U(a){return"vec2 ("+a.a.toPrecision(8)+", "+a.b.toPrecision(8)+")"}
function $a(a,c){a=Ya(a).reverse();for(var b=Y-a.length+1,d=U(R()),e=0;e<b;e++)a.push(d);c=["void f (in vec2 "+c+", out vec2 cs[N+1])","{"];for(b=0;b<=Y;b++)c.push("cs["+b+"] = "+a[b]+";");c.push("}");return c.join("\n")}function ab(a,c,b){a=W(bb(a,c),b);for(var d=[],e=0,f=a.length;e<f;e++)d[e]=X(c,Ya(a[e]));return["vec2 fx (in vec2 "+c+", in vec2 "+b+")","{","    return "+X(b,d)+";","}"].join("\n")}
function cb(a,c,b){a=W(bb(a,b),c);for(var d=[],e=0,f=a.length;e<f;e++)d[e]=X(b,Ya(a[e]));return["vec2 fy (in vec2 "+c+", in vec2 "+b+")","{","    return "+X(c,d)+";","}"].join("\n")}function X(a,c){for(var b=c[0],d=1,e=c.length;d<e;d++)b="vec2 (1.0000000, 0.0000000)"===b?a:"vec2 (-1.0000000, 0.0000000)"===b?"-"+a:"cm ("+a+","+b+")","vec2 (0.0000000, 0.0000000)"!==c[d]&&(b+="+"+c[d]);return b}
function db(a,c,b){var d,e,f=W(a,b);var g=0;for(d=f.length;g<d;g++){var h=f[g].a;var n=0;for(e=h.length;n<e;n++){var l=h[n];h[n]=new u(w(l.b.abs()),l.a)}f[g]=new t(h)}g=f[0];g=eb(g,c,T(g,c));a=eb(a,b,T(a,b));a=fb(Za(a));b=["float M (in vec2 "+c+", in float rho)","{","    vec2 r = vec2 (length ("+c+") + rho, 0.0);","    float a["+f.length+"];","    a[0] = length ("+U(fa(g))+");"];g=0;for(d=a.length;g<d;g++)b.push("    a[0] *= distance ("+c+", "+U(a[g])+") - rho;");g=1;for(d=f.length;g<d;g++)b.push("    a["+
g+"] = length ("+X("r",Ya(f[g]))+");");b=b.concat(["    float m = a[1] / a[0];","    for (int j = 2; j < "+f.length+"; j++) {","        m = max (m, pow (a[j] / a[0], 1.0 / float (j)));","    }","    return 2.0 * m;","}"]);return b.join("\n")}
function gb(a,c,b){var d=eb(a,b,T(a,b)),e=bb(a,b);b=hb(b,a,e);e=b.a;(a=e.length)||console.error("matrix must be non-empty");for(var f=0;f<a;f++)e[f].length!==a&&console.error("matrix must be square");f=b;for(e=1;e<a;e++){f=f.a;for(var g=f[0][0].b(),h=[],n=0,l=f.length;n<l;n++){h[n]=[];for(var q=0;q<l;q++)if(q<n)h[n][q]=g;else if(q===n){for(var p=g,r=q+1;r<l;r++){var v=ca(f[r][r]);p=ba(p,v)}h[n][q]=p}else h[n][q]=f[n][q]}f=(new ib(h)).a;g=b.a;f[0].length!==g.length&&console.error("matrix dimensions must match");
h=[];n=f.length;l=g[0].length;q=f[0][0].b();for(p=0;p<n;p++)for(h[p]=[],r=0;r<l;r++){v=q;for(var C=0,V=f[0].length;C<V;C++){var x=da(f[p][C],g[C][r]);v=ba(v,x)}h[p][r]=v}f=new ib(h)}b=f.a[0][0];a=a%2?b:ca(b);d=fb(Za(d));f=fb(Za(a));e=[];a=0;for(b=d.length;a<b;a++)isFinite(d[a].abs())&&e.push(d[a]);a=0;for(b=f.length;a<b;a++)isFinite(f[a].abs())&&e.push(f[a]);d=["float rho (in vec2 "+c+") {","    float d = 100.0;"];a=0;for(b=e.length;a<b;a++)d.push("    d = min (d, distance ("+c+", "+U(e[a])+"));");
d=d.concat(["    return 0.999 * d;","}"]);return d.join("\n")}var Y=8;
function Xa(a){var c=A(a),b=2>c.length?"x":c[0];c=c.length?c[c.length-1]:"y";return[["#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif","const int N = "+Y+";","const int sheets = "+T(a,c)+";","\n/* complex multiplication */\nvec2 cm (in vec2 a, in vec2 b)\n{\n    return vec2 (a.x * b.x - a.y * b.y, a.x * b.y + a.y * b.x);\n}"].join("\n"),$a(a,b),ab(a,b,c),cb(a,b,c),gb(a,b,c),db(a,b,c)].join("\n\n")};function jb(a,c){var b=kb(),d=a.c;c.h=b.length/2;d.enableVertexAttribArray(0);this.a=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,this.a);d.bufferData(d.ARRAY_BUFFER,new Float32Array(b),d.STATIC_DRAW);b=[K("Initial.vert"),K("Dummy.frag")];b[0]=L(c,b[0]);this.b=M(a,b,["position","delta","subdivisionFlag","values"])}jb.prototype.a=null;jb.prototype.b=null;
jb.prototype.j=function(a,c,b){b.useProgram(this.b);a=(4+2*Y)*c.h;b.enableVertexAttribArray(0);b.bindBuffer(b.ARRAY_BUFFER,this.a);b.vertexAttribPointer(0,2,b.FLOAT,!1,0,0);Ja(b,c,a,function(){b.drawArrays(b.TRIANGLES,0,c.h)});lb(b,c);b.bindBuffer(b.ARRAY_BUFFER,null)};function ib(a){this.a=a}ib.prototype.a=null;function kb(){for(var a=[],c=-10;10>c;c++)for(var b=-10;10>b;b++)a=(c+b)%2?a.concat([c,b,c+1,b+1,c,b+1,c,b,c+1,b,c+1,b+1]):a.concat([c,b,c+1,b,c,b+1,c+1,b,c+1,b+1,c,b+1]);return a.map(function(a){return a/2})};function mb(a,c,b){return a+b*(c-a)};function y(a){this.value=a}function nb(a){var c={};a=a.value;for(var b in a)c[b]=a[b];return new y(c)};function B(a){var c=arguments;return function(a){for(var b,e=[],f=0,g=c.length;f<g;f++)if(b=(0,c[f])(a))e.push(b);else return Array.prototype.unshift.apply(a,e),null;return e}}function na(a){var c=D("("),b=D(")");return function(d){return(d=B(c,a,b)(d))?d[1]:null}}function qa(a){return a.length?null:!0}function pa(a){return function(c){return(c[0]||{}).type===a?c.shift():null}}function ma(a){return function(c){for(var b=a(c),d=[];null!==b;)d.push(b),b=a(c);return d}}
function ja(a){var c=arguments;return function(a){for(var b,e=0,f=c.length;e<f;e++)if(b=(0,c[e])(a))return b;return null}}function la(a,c){return function(b){b=B(a,c)(b);return null===b?null:{type:"prefix",value:b[0].value,first:b[1]}}}function D(a){return function(c){return(c[0]||{}).value===a?c.shift():null}};function t(a){a.length?this.a=ob(a):this.a=[new u(R(),new y({}))]}function ba(a,c){return new t(ob(a.a.concat(c.a)))}function eb(a,c,b){a=a.a;for(var d=[],e=0,f=a.length;e<f;e++){var g=a[e];if((g.a.value[c]||0)===b){var h=nb(g.a);delete h.value[c];d.push(new u(g.b,h))}}return new t(d)}function W(a,c){for(var b=T(a,c),d=[],e=0;e<=b;e++)d[e]=eb(a,c,b-e);return d}
function Za(a){var c=A(a),b=c.length;1<b&&console.error("Polynomial is not univariate");a=W(a,0<b?c[0]:"x");c=[];b=0;for(var d=a.length;b<d;b++)c[b]=fa(a[b]);return c}function fa(a){var c=R();a=a.a;for(var b=0,d=a.length;b<d;b++){var e=a[b],f=e.a.value;null!==f&&Object.keys(f).length||(c=O(c,e.b))}return c}function T(a,c){var b=0;a=a.a;for(var d=0,e=a.length;d<e;d++)b=Math.max(b,a[d].a.value[c]||0);return b}
function bb(a,c){a=a.a;for(var b=[],d=0,e=a.length;d<e;d++){var f=a[d].a,g=f.value[c]||0;if(0<g){var h=Q(a[d].b,w(g));f=nb(f);f.value[c]=g-1;b.push(new u(h,f))}}return new t(b)}function ea(a){return!A(a).length&&!!a.a.length}
function pb(a,c,b){for(var d=a.length-1,e=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],f,g,h,n,l=1;l<=b;l++){h=R();f=R();g=a[0];for(n=1;n<=d;n++)h=O(f,Q(h,c)),f=O(g,Q(f,c)),g=O(a[n],Q(g,c));if(1E-14>g.abs())break;f=P(f,g);n=Q(f,f);g=S(n,P(Q(w(2),h),g));h=Wa(Q(w(d-1),S(Q(w(d),g),n)));g=O(f,h);f=S(f,h);g.abs()<f.abs()&&(g=f);f=1E-14<g.abs()?P(w(d),g):Q(w(c.abs()+1),new z(Math.cos(l),Math.sin(l)));if(1E-14>f.abs())break;!(l%20)&&l<b-19&&(f=Q(f,w(e[Math.floor(l/20)])));c=S(c,f)}return c}
function da(a,c){a=a.a;c=c.a;for(var b=[],d=0,e=a.length;d<e;d++)for(var f=0,g=c.length;f<g;f++){var h=void 0,n=a[d],l=c[f],q={},p=n.a.value,r=l.a.value;for(h in p)q[h]=p[h]+(r[h]||0);for(h in r)q[h]=r[h]+(p[h]||0);b.push(new u(Q(n.b,l.b),new y(q)))}return new t(ob(b))}function ca(a){a=a.a;for(var c=[],b=0,d=a.length;b<d;b++){var e=a[b];c.push(new u(Va(e.b),e.a))}return new t(c)}
function ha(a,c){var b=new t([new u(w(1),new y({}))]);for(Number.isInteger(c)||console.error("Non-integer power of Polynomial!");0<c;c--)b=da(b,a);return b}t.prototype.pow=function(a){return ha(this,a)};function qb(a){var c=a[0],b=a[1];a=a[2];if(!a.a&&!a.b)return[R(),Va(P(b,c))];var d=Wa(S(Q(b,b),Q(w(4),Q(c,a))));0<=b.a&&(d=Va(d));return[P(S(d,b),Q(w(2),c)),P(Q(w(2),a),S(d,b))]}
function fb(a){var c=[],b=a,d=a.length-1;if(0>=d)return[];var e=a[0];if(!e.a&&!e.b)return c=fb(a.slice(1)),c.push(Ua),c;if(1===d)c[0]=Va(P(a[1],a[0]));else if(2===d)c=qb(a);else{for(e=0;e<d-2;e++){c[e]=pb(a,R(),200);c[e]=pb(b,c[e],1);for(var f=c[e],g=[a[0]],h=1,n=a.length-1;h<n;h++)g[h]=O(a[h],Q(g[h-1],f));a=g}b=qb(a);c[d-2]=b[0];c[d-1]=b[1]}return c}function ra(a){var c=A(a);return T(a,c.length?c[c.length-1]:"y")}
function hb(a,c,b){function d(a){for(var b=[],c=0;c<a;c++)b[c]=rb();return b}function e(a,b){return d(b).concat(a).concat(d(f+g-a.length-b))}var f=T(c,a),g=T(b,a);c=W(c,a);a=W(b,a);b=[];for(var h=0;h<g;h++)b.push(e(c,h));for(c=0;c<f;c++)b.push(e(a,c));return new ib(b)}t.prototype.a=null;function A(a){a=a.a;for(var c=[],b={},d=0,e=a.length;d<e;d++){var f=a[d].a.value,g;for(g in f)b[g]||(c.push(g),b[g]=!0)}c.sort();return c}function rb(){return new t([])}t.prototype.b=rb;function Z(a,c,b,d){this.g=a;this.a=c;this.b=b;this.f=d}Z.prototype.abs=function(){return Math.sqrt(this.g*this.g+this.a*this.a+this.b*this.b+this.f*this.f)};function H(a,c){a=-a/2;c=-c/2;return sb(new Z(Math.cos(a),Math.sin(a),0,0),new Z(Math.cos(c),0,0,Math.sin(c)))}function tb(a,c,b){return new Z(mb(a.g,c.g,b),mb(a.a,c.a,b),mb(a.b,c.b,b),mb(a.f,c.f,b))}
function sb(a,c){return new Z(a.g*c.g-a.a*c.a-a.b*c.b-a.f*c.f,a.g*c.a+a.a*c.g+a.b*c.f-a.f*c.b,a.g*c.b-a.a*c.f+a.b*c.g+a.f*c.a,a.g*c.f+a.a*c.b-a.b*c.a+a.f*c.g)}function ub(a){var c=a.abs();return new Z(a.g/c,a.a/c,a.b/c,a.f/c)}function Qa(a){var c=a.g,b=a.a,d=a.b;a=a.f;return[c*c+b*b-d*d-a*a,2*b*d+2*c*a,2*b*a-2*c*d,0,2*b*d-2*c*a,c*c-b*b+d*d-a*a,2*d*a+2*c*b,0,2*b*a+2*c*d,2*d*a-2*c*b,c*c-b*b-d*d+a*a,0,0,0,0,c*c+b*b+d*d+a*a]}function Ea(a,c){return new Z(a.g-c.g,a.a-c.a,a.b-c.b,a.f-c.f)};function sa(){}k=sa.prototype;k.l=!1;k.N=[0,0];k.w=!1;k.A=!1;k.i=H(0,0);k.O=H(0,0);k.m=H(0,0);k.B=1;function Aa(a,c){a.l||(a.N=c,a.A=!0,a.O=a.m)}function Ca(a,c,b){if(a.A){var d=a.N;c-=d[0];b=d[1]-b;d=Math.sqrt(c*c+b*b);var e=a.O,f=d/Math.sqrt(1E4+d*d);a.m=ub(tb(e,sb(new Z(100/Math.sqrt(1E4+d*d),-f*b,f*c,0),e),.05))}}function Fa(a){if(a.l){var c=ub(new Z(.01,0,0,1));c=sb(c,c);a.i=a.m=sb(a.i,c)}else a.i=ub(tb(a.i,a.m,.1))};function ta(a,c){this.ia=c=void 0===c?"webgl2":c;if("webgl"===c){if(a=this.c=a.getContext("webgl",{preserveDrawingBuffer:!0}),!a)throw alert("WebGL not supported. Please try another browser or platform."),Error("WebGL not supported.");}else if(a=this.c=a.getContext("webgl2",{preserveDrawingBuffer:!0}),!a)throw alert("WebGL 2 not supported. Please try another browser or platform."),Error("WebGL 2 not supported.");a.enable(a.DEPTH_TEST);this.J=M(this,N("FXAA"));a=this.c;this.U=c=Math.min(a.getParameter(a.MAX_TEXTURE_SIZE),
8192);this.D=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.D);a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),a.STATIC_DRAW);a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0);a.enableVertexAttribArray(0);this.X=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,this.X);this.Y=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,this.Y);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,c,c);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this.Y);
this.v=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.v);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,c,c,0,a.RGBA,a.UNSIGNED_BYTE,null);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.v,0);this.Z=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,this.Z);this.$=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,this.$);a.renderbufferStorage(a.RENDERBUFFER,
a.DEPTH_COMPONENT16,2048,2048);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this.$);this.u=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.u);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,2048,2048,0,a.RGBA,a.UNSIGNED_BYTE,null);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.u,0);a.bindTexture(a.TEXTURE_2D,null);a.bindRenderbuffer(a.RENDERBUFFER,
null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindBuffer(a.ARRAY_BUFFER,null)}k=ta.prototype;k.U=8192;k.H=!1;k.ia="webgl2";k.I=!0;k.J=null;function K(a){return aa[a].trim()}function N(a){return[K(a+".vert"),K(a+".frag")]}k.c=null;
function M(a,c,b){var d=a.c,e=c[1],f=d.createShader(d.VERTEX_SHADER);d.shaderSource(f,c[0]);d.compileShader(f);d.getShaderParameter(f,d.COMPILE_STATUS)||console.log(d.getShaderInfoLog(f));var g=d.createProgram();d.attachShader(g,f);c[1]&&(c=d.createShader(d.FRAGMENT_SHADER),d.shaderSource(c,e),d.compileShader(c),d.getShaderParameter(c,d.COMPILE_STATUS)||console.log(d.getShaderInfoLog(c)),d.attachShader(g,c));b?(d.transformFeedbackVaryings(g,b,d.INTERLEAVED_ATTRIBS),d.enable(d.RASTERIZER_DISCARD)):
"webgl2"===a.ia&&d.disable(d.RASTERIZER_DISCARD);d.linkProgram(g);d.getProgramParameter(g,d.LINK_STATUS)||console.log(d.getProgramInfoLog(g));d.useProgram(g);return g}
function ya(a,c){var b=a.c,d=b.getParameter(b.FRAMEBUFFER_BINDING),e=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,e);b.bindTexture(b.TEXTURE_2D,c);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,c,0);if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==
b.FRAMEBUFFER_COMPLETE)return b.bindTexture(b.TEXTURE_2D,null),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0),b.bindFramebuffer(b.FRAMEBUFFER,d),b.deleteFramebuffer(e),null;c===a.u?(a=new Uint8Array(16777216),b.readPixels(0,0,2048,2048,b.RGBA,b.UNSIGNED_BYTE,a)):c===a.v?(c=a.U,a=new Uint8Array(4*c*c),b.readPixels(0,0,c,c,b.RGBA,b.UNSIGNED_BYTE,a)):(a=new Float32Array(16777216),b.readPixels(0,0,2048,2048,b.RGBA,b.FLOAT,a));c=b.getError();b.bindTexture(b.TEXTURE_2D,null);
b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0);b.bindFramebuffer(b.FRAMEBUFFER,d);b.deleteFramebuffer(e);return c!==b.NO_ERROR?null:a}k.o=null;function Da(a,c){var b=a.c;vb(a,function(){a.o.j(a,b,c)})}k.D=null;k.X=null;k.Y=null;k.v=null;k.Z=null;k.$=null;k.u=null;k.R=!1;function Oa(a){var c=a.c;c.uniform1f(c.getUniformLocation(c.getParameter(c.CURRENT_PROGRAM),"clipping"),a.H?1:0)}
function Sa(a,c){var b=a.c,d=b.getParameter(b.VIEWPORT);b=d[2];d=d[3];if(c.w){var e=c.B;c=-7.5*e;var f=-7.5*e,g=7.5*e;e*=7.5;var h=Math.min(d/b,1);b=Math.min(b/d,1);b=[2*h/(g-f),0,0,0,0,2*b/(e-c),0,0,0,0,-.01,0,-h*(g+f)/(g-f),-b*(e+c)/(e-c),-0,1]}else c=1/Math.tan(45*c.B/2*Math.PI/180),b=[c/(0<d?b/d:b),0,0,0,0,c,0,0,0,0,101/-99,-1,0,0,200/-99,0];Pa(a,"p",b)}
function Ta(a,c){var b=a.c;a.R&&!1!==c?(b.blendFunc(b.SRC_ALPHA,b.ONE),b.enable(b.BLEND),b.disable(b.DEPTH_TEST)):(b.disable(b.BLEND),b.enable(b.DEPTH_TEST),b.depthFunc(b.LESS))}function Pa(a,c,b){a=a.c;a.uniformMatrix4fv(a.getUniformLocation(a.getParameter(a.CURRENT_PROGRAM),c),!1,b)}function Ra(a,c){Pa(a,"v",c.w?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,-20,1])}
function vb(a,c){if(a.I&&null!==a.J){if(null!==a.J){xa(a,c);c=a.c;var b=a.J;c.useProgram(b);var d=c.getUniformLocation(b,"width");c.uniform1f(d,c.canvas.width);d=c.getUniformLocation(b,"height");c.uniform1f(d,c.canvas.height);c.bindBuffer(c.ARRAY_BUFFER,a.D);c.vertexAttribPointer(0,2,c.FLOAT,!1,0,0);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,a.u);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);c.drawArrays(c.TRIANGLES,0,3)}}else c()}
function xa(a,c,b){var d=a.c;(void 0===b?0:b)?(b=a.U,d.bindFramebuffer(d.FRAMEBUFFER,a.X),d.viewport(0,0,b,b)):(d.bindFramebuffer(d.FRAMEBUFFER,a.Z),d.viewport(0,0,2048,2048));c();d.viewport(0,0,d.canvas.width,d.canvas.height);d.bindFramebuffer(d.FRAMEBUFFER,null)};function wb(a,c){var b=[K("Subdivision.vert"),K("Dummy.frag")];b[0]=L(c,b[0]);this.a=M(a,b,["position","delta","subdivisionFlag","values"])}wb.prototype.a=null;
wb.prototype.j=function(a,c,b){var d,e=c.F,f=this.a;b.useProgram(f);var g=new Float32Array(c.h),h=xb(b,c),n=4+2*Y,l=n*c.h;a=3;for(d=0;a<l;a+=n,d++)g[d]=h[a];l=[1,0,0,0,1,0,0,0,1,1,0,0,0,1,0,.5,0,.5,0,1,0,0,0,1,.5,0,.5,1,0,0,0,1,0,0,.5,.5,0,.5,.5,0,0,1,1,0,0,1,0,0,0,1,0,.5,0,.5,0,.5,.5,0,0,1,.5,0,.5,.5,0,.5,0,1,0,0,.5,.5,1,0,0,.5,.5,0,0,0,1,0,0,1,.5,.5,0,0,1,0,1,0,0,.5,.5,0,.5,0,.5,.5,0,.5,.5,.5,0,0,0,1,0,1,0,0,0,1,.5,.5,0,1,0,0,.5,.5,0,0,.5,.5,0,0,1,1,0,0,0,.5,.5,0,.5,.5,.5,.5,0,0,1,0,1,0,0,.5,.5,
0,.5,0,.5,.5,.5,0,0,1,0,0,.5,.5,0,.5,.5,0,0,1,.5,0,.5,.5,.5,0,0,.5,.5,.5,0,.5,1,0,0,0,1,0,0,.5,.5,0,.5,.5,.5,0,.5,1,0,0,.5,0,.5,0,.5,.5,0,0,1,1,0,0,.5,.5,0,.5,0,.5,.5,0,.5,.5,.5,0,0,1,0,0,1,0,0,0,1,.5,0,.5,1,0,0,.5,.5,0,0,0,1,0,0,1,.5,.5,0,0,.5,.5,0,.5,.5,.5,.5,0,0,1,0];h=[0,3,9,15,24,30,39,48,60,69,78];var q=[3,6,6,9,6,9,9,12,9,9,9],p=[];a=0;for(d=e.length;a<d;a++)b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,e[a]),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),p[a]=a;b.uniform1iv(b.getUniformLocation(f,"samplers"),p);f=[];p=[];var r=0;a=0;for(d=c.h/3;a<d;a++){var v=g[3*a],C=h[v];v=q[v];p.push(l.slice(3*C,3*(C+v)));for(C=0;C<v;C++)f.push(3*a);r+=v}p=Array.prototype.concat.apply([],p);l=n*r;g=b.createBuffer();b.enableVertexAttribArray(0);b.bindBuffer(b.ARRAY_BUFFER,g);b.bufferData(b.ARRAY_BUFFER,new Float32Array(p),
b.STATIC_DRAW);b.vertexAttribPointer(0,3,b.FLOAT,!1,0,0);n=b.createBuffer();b.enableVertexAttribArray(1);b.bindBuffer(b.ARRAY_BUFFER,n);b.bufferData(b.ARRAY_BUFFER,new Float32Array(f),b.STATIC_DRAW);b.vertexAttribPointer(1,1,b.FLOAT,!1,0,0);Ja(b,c,l,function(){b.drawArrays(b.TRIANGLES,0,r)});c.h=r;lb(b,c);a=0;for(d=e.length+1;a<d;a++)b.activeTexture(b.TEXTURE0+a),b.bindTexture(b.TEXTURE_2D,null);b.bindBuffer(b.ARRAY_BUFFER,null);b.deleteBuffer(n);b.deleteBuffer(g);b.disableVertexAttribArray(1)};function yb(a,c){var b=[K("SubdivisionPre.vert"),K("Dummy.frag")];b[0]=L(c,b[0]);this.a=M(a,b,["position","delta","subdivisionFlag","values"])}yb.prototype.a=null;
yb.prototype.j=function(a,c,b){var d=c.F,e=this.a;b.useProgram(e);Ia(c,a);b.vertexAttribPointer(0,1,b.FLOAT,!1,0,0);a=(4+2*Y)*c.h;for(var f=[],g=0,h=d.length;g<h;g++)b.activeTexture(b.TEXTURE0+g),b.bindTexture(b.TEXTURE_2D,d[g]),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),f[g]=g;b.uniform1iv(b.getUniformLocation(e,
"samplers"),f);Ja(b,c,a,function(){b.drawArrays(b.TRIANGLES,0,c.h)});lb(b,c);b.bindBuffer(b.ARRAY_BUFFER,null)};function wa(a,c,b){this.a=c;this.f=b;this.G=ra(c);if(2===A(c).length)if(2>this.G)console.log("There must be at least two sheets!");else{b=a.c;this.ga=b.createBuffer();for(var d=a.c,e=[],f=0;5>f;f++)e[f]=d.createTexture(),d.bindTexture(d.TEXTURE_2D,e[f]),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texImage2D(d.TEXTURE_2D,0,d.RGBA16F,2048,2048,0,d.RGBA,d.FLOAT,null);d.bindTexture(d.TEXTURE_2D,null);this.F=e;d=a.c;this.b=
d.createTransformFeedback();this.P=d.createBuffer();this.ha=aa["Common.glsl"].trim();this.ja=Xa(c);this.K=new jb(a,this);this.K.j(a,this,b);this.M=new yb(a,this);this.L=new wb(a,this);for(c=0;c<this.f;c++)this.M.j(a,this,b),this.L.j(a,this,b);this.g=new Ha(a,this);this.g.j(a,this,b);c=N("Surface");c[1]=L(this,c[1]);this.T=M(a,c);a=b.canvas;b.viewport(0,0,a.width,a.height)}else console.log("Equation must be bivariate!")}k=wa.prototype;k.ha="";k.ja="";
k.aa=function(a,c){return La(this.a,a,void 0===c?!1:c)};k.ba=function(a,c){c=void 0===c?"surface.bin":c;var b=4;b=void 0===b?4+2*Y:b;a=xb(a.c,this,b);a=URL.createObjectURL(new Blob([a],{type:"application/octet-binary"}));J(c,a)};k.ca=function(a,c,b){Ma(this.a,a,void 0===c?"sheet":c,void 0===b?!0:b)};k.da=function(a,c,b){c=void 0===c?"surface":c;b=void 0===b?!0:b;var d=xb(a.c,this,4);Na(a,d,c,b)};
function Ia(a,c){c=c.c;for(var b=[],d=0;d<a.h;d++)b[d]=d;c.bindBuffer(c.ARRAY_BUFFER,a.ga);c.bufferData(c.ARRAY_BUFFER,new Float32Array(b),c.STATIC_DRAW)}k.ga=null;k.h=0;k.T=null;k.j=function(a,c,b){this.T&&(c.useProgram(this.T),Oa(a),Pa(a,"m",Qa(b.i)),Ra(a,b),Sa(a,b),Ta(a),c.bindBuffer(c.ARRAY_BUFFER,this.P),c.vertexAttribPointer(0,4,c.FLOAT,!1,0,0),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),c.drawArrays(c.TRIANGLES,0,this.h),Ta(a,!1))};k.G=0;k.F=[];k.P=null;
function L(a,c){return["#version 300 es",a.ja,a.ha,c].join("\n")};function u(a,c){this.b=a;this.a=c}u.prototype.b=null;u.prototype.a=null;
function ob(a){function c(a,d){if(d.length){if(1===d.length)return a.push(d[0]),a;var b=d.pop(),f=b.b;b=b.a;for(var g=[],h=0,n=d.length;h<n;h++){a:{var l=void 0;var q=b,p=d[h].a;for(l in q.value)if(!p.value.hasOwnProperty(l)||q.value[l]!==p.value[l]){l=!1;break a}for(l in p.value)if(!q.value.hasOwnProperty(l)||q.value[l]!==p.value[l]){l=!1;break a}l=!0}l?f=O(f,d[h].b):g.push(d[h])}a.push(new u(f,b));return c(a,g)}return a}return c([],a)};function zb(){this.a=[["\\d*\\.\\d*","number"],["\\d+","number"],["i","imaginary"],["[a-hj-z]","variable"],["[\\+\\*\\^-]","operator"],["[\\(\\)]","parenthesis"]]}function oa(a){for(var c=(new zb).a,b="(?:",d=0,e=c.length;d<e;d++)b+=(0<d?"|(":"(")+c[d][0]+")";b=new RegExp(b+")","g");for(d=[];null!==(e=b.exec(a));){var f=e[0];d.push({type:c[e.slice(1).indexOf(f)][1],value:f})}return d};function xb(a,c,b){b=void 0===b?4+2*Y:b;b=new Float32Array(b*c.h);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,c.b);a.bindBufferBase(a.TRANSFORM_FEEDBACK_BUFFER,0,c.P);a.getBufferSubData(a.TRANSFORM_FEEDBACK_BUFFER,0,b);a.bindBufferBase(a.TRANSFORM_FEEDBACK_BUFFER,0,null);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null);return b}
function lb(a,c){var b=void 0===b?4+2*Y:b;for(var d=c.F,e=xb(a,c,b),f=new Float32Array(16777216),g=0;g<=Y/2;g++){a.bindTexture(a.TEXTURE_2D,d[g]);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);for(var h=0;h<c.h;h++)for(var n=0;4>n;n++)f[4*h+n]=e[b*h+4*g+n];a.texImage2D(a.TEXTURE_2D,0,a.RGBA16F,2048,
2048,0,a.RGBA,a.FLOAT,f)}}function Ja(a,c,b,d){a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,c.b);a.bindBufferBase(a.TRANSFORM_FEEDBACK_BUFFER,0,c.P);a.bufferData(a.TRANSFORM_FEEDBACK_BUFFER,b*Float32Array.BYTES_PER_ELEMENT,a.STATIC_COPY);a.beginTransformFeedback(a.TRIANGLES);d();a.endTransformFeedback();a.bindBufferBase(a.TRANSFORM_FEEDBACK_BUFFER,0,null);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null)};
})();//# sourceMappingURL=ComplexCurves.js.map

(function(){
'use strict';CindyJS.registerPlugin(1,"ComplexCurves",function(a){function b(b,a){var c,d;for(c in b)(d=a[c])?d(n(b[c])):console.log("Modifier "+c+" not supported")}function e(a,e){a=h(a[0],"CSCanvas");var c=g[a];if(!c)return console.log("Unknown instance '"+a+"'"),l;var d=1,f=[0,0,0];b(e,{alpha:function(a){d=k(a,d)},autorotate:function(a){c.setAutorotate(m(a))},background:function(a){f=q(a,f)},clip:function(a){c.setClipping(m(a))},ortho:function(a){c.setOrtho(m(a))},transparency:function(a){c.setTransparency(m(a))},
view:function(a){switch(h(a)){case "Back":c.rotateBack();break;case "Bottom":c.rotateBottom();break;case "Default":c.rotateDefault();break;case "Front":c.rotateFront();break;case "Left":c.rotateLeft();break;case "Right":c.rotateRight();break;case "Top":c.rotateTop()}},zoom:function(a){c.setZoom(r(a,1))}});c.setBackground(f[0],f[1],f[2],d);return l}var l=a.nada,n=a.evaluate;a=a.defineFunction;var g={};a("ComplexCurves",1,e);a("ComplexCurves",2,function(a,b){var c=h(a[0],"CSCanvas"),d=document.getElementById(c),
f=h(a[1],"y^2-x"),p=12;void 0!==b.depth&&(p=t(n(b.depth)));delete b.depth;g[c]&&g[c].f&&g[c].f();if(".bin"===f.substr(-4,4))var u=ComplexCurves.fromFile(d,f,"",void 0,void 0,void 0,function(){g[c]=u;e([a[0]],b)});else if(d=ComplexCurves.fromEquation(d,f,p))g[c]=d,e([a[0]],b);return l})});function v(a){var b;b=void 0===b?null:b;return"list"!==a.ctype?(console.log("argument is not a list"),b):a.value}function q(a,b){b=void 0===b?[.5,.5,.5]:b;if("number"===a.ctype){var e=k(a);if(!isNaN(e))return[e,e,e]}a=v(a);return null===a?b:3!=a.length?(console.log("Not an RGB color vector"),b):a.map(function(a){return k(a)})}
function r(a,b){b=void 0===b?Number.NaN:b;if("number"!==a.ctype)return console.log("argument is not a number"),b;a=a.value;b=a.real;0!==a.imag&&console.log("complex number is not real");return b}function t(a){var b=12,b=void 0===b?Number.NaN:b;if("number"!==a.ctype)return console.log("argument is not a number"),b;b=a.value;a=b.real;b=b.imag;0!==b&&console.log("complex number is not real");b=Math.round(a);b!==a&&console.log("number is not an integer");return b}
function k(a,b){b=void 0===b?Number.NaN:b;a=r(a,b);return 0>a?0:1<a?1:a}function h(a,b){b=void 0===b?null:b;if("string"===a.ctype)return a.value;console.log("argument is not a string");return b}function m(a){if("boolean"===a.ctype)return a.value;console.log("argument is not boolean");return!1};
})();

//# sourceMappingURL=ComplexCurves.js.map
